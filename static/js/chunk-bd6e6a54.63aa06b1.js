(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-bd6e6a54"],{1148:function(e,t,n){"use strict";var r=n("a691"),a=n("1d80");e.exports=function(e){var t=String(a(this)),n="",i=r(e);if(i<0||i==1/0)throw RangeError("Wrong number of repetitions");for(;i>0;(i>>>=1)&&(t+=t))1&i&&(n+=t);return n}},"408a":function(e,t,n){var r=n("c6b6");e.exports=function(e){if("number"!=typeof e&&"Number"!=r(e))throw TypeError("Incorrect invocation");return+e}},b680:function(e,t,n){"use strict";var r=n("23e7"),a=n("a691"),i=n("408a"),s=n("1148"),o=n("d039"),u=1..toFixed,c=Math.floor,l=function(e,t,n){return 0===t?n:t%2==1?l(e,t-1,n*e):l(e*e,t/2,n)},f=function(e,t,n){for(var r=-1,a=n;++r<6;)a+=t*e[r],e[r]=a%1e7,a=c(a/1e7)},d=function(e,t){for(var n=6,r=0;--n>=0;)r+=e[n],e[n]=c(r/t),r=r%t*1e7},h=function(e){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==e[t]){var r=String(e[t]);n=""===n?r:n+s.call("0",7-r.length)+r}return n};r({target:"Number",proto:!0,forced:u&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!o((function(){u.call({})}))},{toFixed:function(e){var t,n,r,o,u=i(this),c=a(e),p=[0,0,0,0,0,0],g="",v="0";if(c<0||c>20)throw RangeError("Incorrect fraction digits");if(u!=u)return"NaN";if(u<=-1e21||u>=1e21)return String(u);if(u<0&&(g="-",u=-u),u>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(u*l(2,69,1))-69)<0?u*l(2,-t,1):u/l(2,t,1),n*=4503599627370496,(t=52-t)>0){for(f(p,0,n),r=c;r>=7;)f(p,1e7,0),r-=7;for(f(p,l(10,r,1),0),r=t-1;r>=23;)d(p,1<<23),r-=23;d(p,1<<r),f(p,1,1),d(p,2),v=h(p)}else f(p,0,n),f(p,1<<-t,0),v=h(p)+s.call("0",c);return v=c>0?g+((o=v.length)<=c?"0."+s.call("0",c-o)+v:v.slice(0,o-c)+"."+v.slice(o-c)):g+v}})},f3b3:function(e,t,n){"use strict";n.r(t);n("99af"),n("4de4"),n("c740"),n("4160"),n("caad"),n("d81d"),n("13d5"),n("fb6a"),n("a434"),n("b0c0"),n("a9e3"),n("b680"),n("b64b"),n("d3b7"),n("2532"),n("3ca3"),n("159b"),n("ddb0");var r=n("3835"),a=(n("96cf"),n("1da1")),i={wait:"wait",pause:"pause",uploading:"uploading"},s={filters:{transformByte:function(e){return Number((e/1024).toFixed(0))}},data:function(){return{Status:i,container:{file:null,hash:"",worker:null},hashPercentage:0,data:[],requestList:[],status:i.wait,fakeUploadPercentage:0}},computed:{uploadDisabled:function(){return!this.container.file||[i.pause,i.uploading].includes(this.status)},uploadPercentage:function(){if(!this.container.file||!this.data.length)return 0;var e=this.data.map((function(e){return e.size*e.percentage})).reduce((function(e,t){return e+t}));return parseInt((e/this.container.file.size).toFixed(2))}},watch:{uploadPercentage:function(e){e>this.fakeUploadPercentage&&(this.fakeUploadPercentage=e)}},methods:{handlePause:function(){this.status=i.pause,this.resetData()},resetData:function(){this.requestList.forEach((function(e){return null==e?void 0:e.abort()})),this.requestList=[],this.container.worker&&(this.container.worker.onmessage=null)},handleResume:function(){var e=this;return Object(a.a)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.status=i.uploading,t.next=3,e.verifyUpload(e.container.file.name,e.container.hash);case 3:return n=t.sent,r=n.uploadedList,t.next=7,e.uploadChunks(r);case 7:case"end":return t.stop()}}),t)})))()},request:function(e){var t=e.url,n=e.method,r=void 0===n?"post":n,a=e.data,i=e.headers,s=void 0===i?{}:i,o=e.onProgress,u=void 0===o?function(e){return e}:o,c=e.requestList;return new Promise((function(e){var n=new XMLHttpRequest;n.upload.onprogress=u,n.open(r,t),Object.keys(s).forEach((function(e){return n.setRequestHeader(e,s[e])})),n.send(a),n.onload=function(t){if(c){var r=c.findIndex((function(e){return e===n}));c.splice(r,1)}e({data:t.target.response})},null==c||c.push(n)}))},createFileChunk:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10485760,n=[],r=0;r<e.size;)n.push({file:e.slice(r,r+t)}),r+=t;return n},calculateHash:function(e){var t=this;return new Promise((function(n){t.container.worker=new Worker("/hash.js"),t.container.worker.postMessage({fileChunkList:e}),t.container.worker.onmessage=function(e){var r=e.data,a=r.percentage,i=r.hash;t.hashPercentage=a,i&&n(i)}}))},handleFileChange:function(e){var t=Object(r.a)(e.target.files,1)[0];t&&(this.resetData(),Object.assign(this.$data,this.$options.data()),this.container.file=t)},handleUpload:function(){var e=this;return Object(a.a)(regeneratorRuntime.mark((function t(){var n,r,a,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.container.file){t.next=2;break}return t.abrupt("return");case 2:return e.status=i.uploading,n=e.createFileChunk(e.container.file),t.next=6,e.calculateHash(n);case 6:return e.container.hash=t.sent,t.next=9,e.verifyUpload(e.container.file.name,e.container.hash);case 9:if(r=t.sent,a=r.shouldUpload,s=r.uploadedList,a){t.next=16;break}return e.$message.success("秒传：上传成功"),e.status=i.wait,t.abrupt("return");case 16:return e.data=n.map((function(t,n){var r=t.file;return{fileHash:e.container.hash,index:n,hash:"".concat(e.container.hash,"-").concat(n),chunk:r,size:r.size,percentage:s.includes(n)?100:0}})),t.next=19,e.uploadChunks(s);case 19:case"end":return t.stop()}}),t)})))()},uploadChunks:function(){var e=arguments,t=this;return Object(a.a)(regeneratorRuntime.mark((function n(){var r,i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:[],i=t.data.filter((function(e){var t=e.hash;return!r.includes(t)})).map((function(e){var n=e.chunk,r=e.hash,a=e.index,i=new FormData;return i.append("chunk",n),i.append("hash",r),i.append("filename",t.container.file.name),i.append("fileHash",t.container.hash),{formData:i,index:a}})).map(function(){var e=Object(a.a)(regeneratorRuntime.mark((function e(n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.formData,a=n.index,e.abrupt("return",t.request({url:"http://localhost:3000",data:r,onProgress:t.createProgressHandler(t.data[a]),requestList:t.requestList}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.next=4,Promise.all(i);case 4:if(r.length+i.length!==t.data.length){n.next=7;break}return n.next=7,t.mergeRequest();case 7:case"end":return n.stop()}}),n)})))()},mergeRequest:function(){var e=this;return Object(a.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.request({url:"http://localhost:3000/merge",headers:{"content-type":"application/json"},data:JSON.stringify({size:10485760,fileHash:e.container.hash,filename:e.container.file.name})});case 2:e.$message.success("上传成功"),e.status=i.wait;case 4:case"end":return t.stop()}}),t)})))()},verifyUpload:function(e,t){var n=this;return Object(a.a)(regeneratorRuntime.mark((function r(){var a,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.request({url:"http://localhost:3000/verify",headers:{"content-type":"application/json"},data:JSON.stringify({filename:e,fileHash:t})});case 2:return a=r.sent,i=a.data,r.abrupt("return",JSON.parse(i));case 5:case"end":return r.stop()}}),r)})))()},createProgressHandler:function(e){return function(t){e.percentage=parseInt(String(t.loaded/t.total*100))}}}},o=n("2877"),u=Object(o.a)(s,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",[n("input",{attrs:{type:"file",disabled:e.status!==e.Status.wait},on:{change:e.handleFileChange}}),n("el-button",{attrs:{disabled:e.uploadDisabled},on:{click:e.handleUpload}},[e._v("上传")]),e.status===e.Status.pause?n("el-button",{on:{click:e.handleResume}},[e._v("恢复")]):n("el-button",{attrs:{disabled:e.status!==e.Status.uploading||!e.container.hash},on:{click:e.handlePause}},[e._v("暂停")])],1),n("div",[n("div",[e._v("计算文件 hash")]),n("el-progress",{attrs:{percentage:e.hashPercentage}}),n("div",[e._v("总进度")]),n("el-progress",{attrs:{percentage:e.fakeUploadPercentage}})],1),n("el-table",{attrs:{data:e.data}},[n("el-table-column",{attrs:{prop:"hash",label:"切片hash",align:"center"}}),n("el-table-column",{attrs:{label:"大小(KB)",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v(" "+e._s(e._f("transformByte")(n.size))+" ")]}}])}),n("el-table-column",{attrs:{label:"进度",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row;return[n("el-progress",{attrs:{percentage:t.percentage,color:"#909399"}})]}}])})],1)],1)}),[],!1,null,null,null);t.default=u.exports}}]);